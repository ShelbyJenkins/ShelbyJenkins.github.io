---
import { easyConfig } from '../siteConfig';
import FormattedDate from '../components/FormattedDate.astro';
import { Image } from 'astro:assets';
import { formatDescription } from '../utils/abbreviateDescription';
import BaseLayout from './BaseLayout.astro';
import { customGetCollection } from '../utils/customGetCollection';

const { blogCollectionName, basePath } = Astro.props;
const blogCollection = await customGetCollection(blogCollectionName, basePath);
let posts = blogCollection.sort((a, b) => {
	// Sort by updatedDate if available, otherwise fall back to pubDate
	const dateA = a.props.data.updatedDate ? new Date(a.props.data.updatedDate) : new Date(a.props.data.pubDate);
	const dateB = b.props.data.updatedDate ? new Date(b.props.data.updatedDate) : new Date(b.props.data.pubDate);
	// Sort in descending order (newest first)
	return dateB.valueOf() - dateA.valueOf();
});
const heroImage = posts.length > 0 ? posts[0].props.data.heroImage : undefined;
const heroAlt = posts.length > 0 ? posts[0].props.data.heroAlt : undefined;
---

<BaseLayout title={easyConfig.site_title} page_description={easyConfig.site_description} heroImage={heroImage} heroAlt={heroAlt}>
	<ul class="flex w-full list-none flex-col items-start py-4 pl-2 pr-2 md:pl-24 md:pr-16">
		{
			posts.map((post, i) => {
				return (
					<>
						<li class="mb-4 max-h-[30vh] min-w-full ">
							<a class="group flex min-w-full items-center justify-between hover:no-underline" href={`${post.params.htmlSlug}`}>
								<div class="lg:w-10/12 flex max-h-full w-full flex-col">
									<div class="lg:text-xs text-xs font-medium text-semantic-on-background/70 md:text-base">
										<FormattedDate
											date={
												post.props.data.updatedDate ? new Date(post.props.data.updatedDate) : new Date(post.props.data.pubDate)
											}
										/>
									</div>
									<div class="lg:h-[15vh] flex w-full">
										<div class="pr-10">
											<h1 class="lg:font-bold text-lg font-semibold group-hover:text-semantic-primary md:text-xl ">
												{post.props.data.title}
											</h1>
											<div class="lg:font-medium line-clamp-6 text-sm md:line-clamp-4 ">
												{formatDescription(post.props.data.description, post.props.body)}
											</div>
										</div>
										<div class="group-hover:shadow-gradient lg:h-[15vh] lg:w-[15vh] ml-auto mr-0 flex h-[5vh] w-[5vh] shrink-0">
											{post.props.data.heroImage ? (
												<Image class="rounded object-cover" src={post.props.data.heroImage} alt={post.props.data.heroAlt || ''} />
											) : (
												<div class="h-full w-full rounded bg-semantic-primary-container/20" />
											)}
										</div>
									</div>
									<div class="lg:text-xs pt-5 text-xs font-normal italic text-semantic-on-background/70 md:text-base">
										{[post.props.data.readingTime]}
									</div>
									{posts.length != i + 1 && <hr class="mt-7 w-full border-semantic-on-surface-variant/5 " />}
								</div>
							</a>
						</li>
					</>
				);
			})
		}
	</ul>
</BaseLayout>
<style>
	a {
		color: theme(colors.semantic.on-background);
	}
</style>
